#:kivy 1.9.2

CosGame:


<CosGame>:
    gameworld: gameworld

    GameWorld:
        id: gameworld
        gamescreenmanager: gamescreenmanager
        size_of_gameworld: 100 * 1024
        size_of_entity_block: 128
        system_count: 2
        zones: {'general': 10000}

        PositionSystem2D:
            system_id: 'position'
            gameworld: gameworld
            zones: ['general']
            size_of_component_block: 128

        Renderer:
            gameworld: gameworld
            system_id: 'renderer'
            zones: ['general']
            frame_count: 2
            updateable: True
            force_update: True
            size_of_batches: 512
            size_of_component_block: 128
            gameview: 'camera'
            shader_source: 'assets/shaders/positionshader.glsl'

        GameScreenManager:
            id: gamescreenmanager
            gameworld: gameworld
            size: root.size
            pos: root.pos

        GameView:
            system_id: 'camera'
            gameworld: gameworld
            size: root.size
            camera_scale: 20
            pos: root.pos
            do_scroll: True


<GameScreenManager>:
    MainMenuScreen:
        id: main_menu_screen

    CosScreen:
        id: cos_screen

    MapScreen:
        id: map_screen


<MainMenuScreen@GameScreen>:
    name: 'main_menu_screen'

    FloatLayout:
        orientation: 'vertical'
        padding: 12
        spacing: 10
        pos_hint: {'center_x':.5, 'center_y':.5}
        size_hint: 1, 1

        Button:
            size_hint: (.2, .1)
            pos_hint: {'x': .025, 'y': .875}
            text: 'Cos'
            on_release: app.game.goToCosScreen()

        Button:
            size_hint: (.2, .1)
            pos_hint: {'x': .5025, 'y': .875}
            text: 'Search Towns'
            on_release: app.game.goToMapScreen()


<CosScreen@GameScreen>:
    name: 'cos_screen'

    FloatLayout:
        Button:
            size_hint: (.2, .1)
            pos_hint: {'x': .025, 'y': .875}
            text: 'MainMenu'
            on_release: app.game.goToMainMenuScreen()

        Button:
            size_hint: (.2, .1)
            pos_hint: {'x': .5025, 'y': .875}
            text: 'Draw play map'
            on_release: app.game.drawPlayMap()


<MapScreen@GameScreen>:
    name: 'map_screen'

    map_box: root.map_box
    map_nums: root.map_nums
    names_box: root.names_box

    BoxLayout:
        id: outer_box
        size_hint: 1, 1
        orientation: 'horizontal'
        padding: 12
        spacing: 10
        pos_hint: {'center_x':.5, 'center_y':.5}

        BoxLayout:
            size_hint: .3, 1
            orientation: 'vertical'
            padding: 12
            spacing: 10
            pos: 0, outer_box.height/2 - self.height/2

            Spinner:
                size_hint: 1, None
                text: 'Maps'
                values: [idx for idx in root.map_nums]
                on_text: root.showMap(*args)

            Button:
                text: 'Gen Town'
                on_release: root.generateTown()
                size_hint: 1, None

            Button:
                text: 'Main Menu'
                on_release: app.game.goToMainMenuScreen()
                size_hint: 1, None

        ScrollView:
            Label:
                markup: True
                text: root.map_box
                font_name: 'RobotoMono-Regular.ttf'
                size_hint_y: None
                size_hint_x: None
                height: self.texture_size[1]
                width: self.texture_size[0]
                on_ref_press: root.labelPress(*args)

        ScrollView:
            Label:
                markup: True
                text: root.names_box
                size_hint_y: None
                height: self.texture_size[1]
